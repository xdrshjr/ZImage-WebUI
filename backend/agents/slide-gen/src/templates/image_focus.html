{% extends "base.html" %}

{% block content %}
<div class="slide {{ style }}">
    <h1 class="slide-title">{{ title }}</h1>
    
    <div class="content-area">
        {% set text_blocks = [] %}
        {% for block in content_blocks %}
            {% if block.type == 'text' %}
                {% set _ = text_blocks.append(block) %}
            {% endif %}
        {% endfor %}
        
        {% for idx, block in enumerate(content_blocks) %}
            {% if block.type == 'text' %}
                <div class="text-block" style="left: {{ block.position.x }}px; top: {{ block.position.y }}px; width: {{ block.position.width }}px; height: {{ block.position.height }}px; max-height: {{ block.position.height }}px;">
                    {% if block.section_title %}
                        <!-- Add section separator before section header (except first text block) -->
                        {% if idx > 0 and text_blocks|length > 1 and block == text_blocks[1:][0] if text_blocks|length > 1 else false %}
                            <div class="section-separator" style="margin-top: 0;"></div>
                        {% endif %}
                        {% if block.icon %}
                            <div class="section-header-with-icon">
                                <svg class="section-icon">
                                    <use href="#{{ block.icon }}"/>
                                </svg>
                                <div class="section-header">{{ block.section_title }}</div>
                            </div>
                        {% else %}
                            <div class="section-header">{{ block.section_title }}</div>
                        {% endif %}
                    {% endif %}
                    {# Calculate header height dynamically based on CSS variable - add icon height if present #}
                    {% set header_height = 'var(--header-size) * 1.2 + 16px' if block.section_title else '0px' %}
                    <div class="text-content text-overflow-safe" style="max-height: calc({{ block.position.height }}px - ({% if block.section_title %}{{ header_height }}{% else %}0px{% endif %})); -webkit-line-clamp: 8; overflow: hidden; word-wrap: break-word;">{{- block.content -}}</div>
                </div>
            {% elif block.type == 'image_placeholder' and block.image_path %}
                {% set img_x = [block.position.x, 60]|max %}
                {% set img_y = [block.position.y, 80]|max %}
                {% set max_right = width - 60 %}
                {% set max_bottom = height - 80 %}
                {% set img_width = [block.position.width, max_right - img_x]|min %}
                {% set img_height = [block.position.height, max_bottom - img_y]|min %}
                <div class="image-container" style="left: {{ img_x }}px; top: {{ img_y }}px; width: {{ img_width }}px; height: {{ img_height }}px; margin: 0; max-width: none; max-height: none;">
                    <img src="{{ block.image_path }}" alt="Slide image">
                </div>
            {% endif %}
        {% endfor %}
    </div>
    
    <!-- Footer accent line -->
    <div class="footer-accent"></div>
</div>
{% endblock %}
